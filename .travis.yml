language: node_js
node_js:
- node
services: mongodb
cache:
  directories:
  - node_modules
install:
- npm install
branches:
  only:
  - master
  - development
script:
- sleep 5
before_deploy:
- mkdir dist
- echo "Building client distribution."
- cd client
- npm i
- npm run build
- cd ..
- echo "Finished building client distribution."
- echo "Building server distribution."
- cd server
- npm i
- npm run build
- zip server.zip dist package.json .env-cmdrc .ebextensions
- cd ..
- echo "Finished building server distribution."
deploy:
- provider: elasticbeanstalk
  skip_cleanup: true
  zip_file: server/server.zip
  access_key_id:
    secure: ZLLiBkpVkb12nmvAznX+bmMJGF49LQMROy1egEP78YUDpEyPEPKtXHClYGhlGShTyXHLwzbju3aUFNAlzGtMUaZkjOSVWfj+8evvp1rGgOvDPHL+wCSW3iRsp+iCKkA0Ft6iF7+EWFYV8RjPoqTOoQIpRDJzogHtFaZ3JkN0pHXtM/0FKW9S+s+PU1+dIrg/iRZ3+H2DbnUpxdN37opJhxS0loE0/f/aIM2mBasrf7k2MjiP3pt3JXaVB4us96si2tp1mAY2paR4m/hFX/Q9afQnVtbGS97CI18tiau72NXy4soWNg0NyX3cdRYVLyZs0QAcPPGrVGbYhUcef0V8uu1/PoXKBgLspFQuGGD51H8TOG/Wzu6mxaoeSchex5RrSmsicP3IwyTYg4AhC7G7g+HXkw3Cpt87oUXs7R5t9Tht6jFrO9FYWlGxpfKpG+GH0nmcdayYw8TbV0/U0i3f/uGaTp1lgodrpsr62ONQYbDD9Us+IXD+HbBeM1DVNV+1dcxEY+rsWXTuLcZYYNmYVQ/Pt0WGtLEMdz+QTJbTJmO21ABAuxHwFLGS7ETuhuuiZ1G6jomVNZx4C/3Fybm7FXfkHcpqf9V2vwUpWEPMhovCf9g55iVnuy4dDXC72jFeECz9VZ2aA2OFkK61QoAi/g1bRlwLrGgyYAiDmq0Aans=
  secret_access_key:
    secure:
      5lecXkVyBtwuxVwXII90LWwhSYFQKVGO2OZHKSC7zKQw3bAXDHXsIOQrCyK0gtb/4+sJ+N2vZrBKhDljinXfRpmaJIZTNbB9y4/svLrQAjOig+24ZibhpfY87ZWQFiYWBZnjURfFyuQOAhvwvTVq+h4RY0r3PfH8CWPyk38BS8PaW4X+Y+TVcTgEVOVFxHciyVQUEIcnpZhuP9VOso+oejCvclizH87KwtpLr8B+wLDDooPBMdEuL0OGELDR+PPF/hcMFGX1cxiXIUmNeWnqtshQdwPikOKONn7jXcVQ4aRv5X5rnLElU95nPaGpplnBQ3pOtAeYMBHLJJTAf3FB82JexpZ6G50DoEzZswYTkN7Bfx+hcCRO9jd+nHb1p8rIfGmPTZrXyTOfCrQ2w9K3jRIvV5jrWMozL5soggq+4gVEGzPUWSGeuvjVZfc55BGXkXYObCi86u0rkcP3KwVA65JsOTqmCfeCwqk3ZARhlOjxCKHINADpg31l+xu1ItdOVyNjP9IttQwwMAfM3Ghlj/dJqCIpB5uP2fEnzzsWhvbzKh9qn96LKUGZOdYLORO2HtcihfgztpYG19FyGBJvO1M77rMrEkacEcu6NFnhhx631uVuePe99YE2V8pXOsf6WYz3PRyZNTrss/hbnCqdl8ehM2CMFPyLStyNIYnMzZI=
  region: us-east-1
  app: campfire-stories
  env: projects
  bucket_name: elasticbeanstalk-us-east-1-812452178264
  on:
    branch: master
- provider: s3
  access_key_id:
    secure: ZLLiBkpVkb12nmvAznX+bmMJGF49LQMROy1egEP78YUDpEyPEPKtXHClYGhlGShTyXHLwzbju3aUFNAlzGtMUaZkjOSVWfj+8evvp1rGgOvDPHL+wCSW3iRsp+iCKkA0Ft6iF7+EWFYV8RjPoqTOoQIpRDJzogHtFaZ3JkN0pHXtM/0FKW9S+s+PU1+dIrg/iRZ3+H2DbnUpxdN37opJhxS0loE0/f/aIM2mBasrf7k2MjiP3pt3JXaVB4us96si2tp1mAY2paR4m/hFX/Q9afQnVtbGS97CI18tiau72NXy4soWNg0NyX3cdRYVLyZs0QAcPPGrVGbYhUcef0V8uu1/PoXKBgLspFQuGGD51H8TOG/Wzu6mxaoeSchex5RrSmsicP3IwyTYg4AhC7G7g+HXkw3Cpt87oUXs7R5t9Tht6jFrO9FYWlGxpfKpG+GH0nmcdayYw8TbV0/U0i3f/uGaTp1lgodrpsr62ONQYbDD9Us+IXD+HbBeM1DVNV+1dcxEY+rsWXTuLcZYYNmYVQ/Pt0WGtLEMdz+QTJbTJmO21ABAuxHwFLGS7ETuhuuiZ1G6jomVNZx4C/3Fybm7FXfkHcpqf9V2vwUpWEPMhovCf9g55iVnuy4dDXC72jFeECz9VZ2aA2OFkK61QoAi/g1bRlwLrGgyYAiDmq0Aans=
  secret_access_key:
    secure:
      5lecXkVyBtwuxVwXII90LWwhSYFQKVGO2OZHKSC7zKQw3bAXDHXsIOQrCyK0gtb/4+sJ+N2vZrBKhDljinXfRpmaJIZTNbB9y4/svLrQAjOig+24ZibhpfY87ZWQFiYWBZnjURfFyuQOAhvwvTVq+h4RY0r3PfH8CWPyk38BS8PaW4X+Y+TVcTgEVOVFxHciyVQUEIcnpZhuP9VOso+oejCvclizH87KwtpLr8B+wLDDooPBMdEuL0OGELDR+PPF/hcMFGX1cxiXIUmNeWnqtshQdwPikOKONn7jXcVQ4aRv5X5rnLElU95nPaGpplnBQ3pOtAeYMBHLJJTAf3FB82JexpZ6G50DoEzZswYTkN7Bfx+hcCRO9jd+nHb1p8rIfGmPTZrXyTOfCrQ2w9K3jRIvV5jrWMozL5soggq+4gVEGzPUWSGeuvjVZfc55BGXkXYObCi86u0rkcP3KwVA65JsOTqmCfeCwqk3ZARhlOjxCKHINADpg31l+xu1ItdOVyNjP9IttQwwMAfM3Ghlj/dJqCIpB5uP2fEnzzsWhvbzKh9qn96LKUGZOdYLORO2HtcihfgztpYG19FyGBJvO1M77rMrEkacEcu6NFnhhx631uVuePe99YE2V8pXOsf6WYz3PRyZNTrss/hbnCqdl8ehM2CMFPyLStyNIYnMzZI=
  bucket: campfire-stories
  skip_cleanup: true
  region: us-east-1
  local_dir: client/build
  on:
    branch: master
notifications:
  email:
    recipients:
    - hansen.mmb@gmail.com
    on_success: always
    on_failure: always
